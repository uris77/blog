<!doctype html>
<html lang="en-us">
  <head>
    <title>Go Notes: Parsing Claims in Firebase JWT Token // Openstep Blog</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.85.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="John Doe" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://blog.openstep.net/css/main.min.88e7083eff65effb7485b6e6f38d10afbec25093a6fac42d734ce9024d3defbd.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Go Notes: Parsing Claims in Firebase JWT Token"/>
<meta name="twitter:description" content="I struggled to parse the Firebase JWT Claims. Because claims may contain strings, maps, and arrays, the claims field type is an []interface{}. In this example, one of the claims was a list of permissions. Permissions themselves were just an array of strings. Go does not know that it is an array string, and it is impossible to convert it directly. Instead, we need an intermediary conversion.
The Firebase Token struct is defined as:"/>

    <meta property="og:title" content="Go Notes: Parsing Claims in Firebase JWT Token" />
<meta property="og:description" content="I struggled to parse the Firebase JWT Claims. Because claims may contain strings, maps, and arrays, the claims field type is an []interface{}. In this example, one of the claims was a list of permissions. Permissions themselves were just an array of strings. Go does not know that it is an array string, and it is impossible to convert it directly. Instead, we need an intermediary conversion.
The Firebase Token struct is defined as:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.openstep.net/posts/go-firebase-claims/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-04T13:21:37-06:00" />
<meta property="article:modified_time" content="2021-03-04T13:21:37-06:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="https://blog.openstep.net"><img class="app-header-avatar" src="/openstep.jpg" alt="John Doe" /></a>
      <h1>Openstep Blog</h1>
      <p>Cloud &amp; Engineering Topics</p>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Go Notes: Parsing Claims in Firebase JWT Token</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Mar 4, 2021
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          2 min read
        </div>
      </div>
    </header>
    <div class="post-content">
      <p>I struggled to parse the Firebase JWT Claims. Because claims may contain strings, maps, and arrays, the claims field type is an []interface{}. In this example, one of the claims was a list of permissions. Permissions themselves were just an array of strings. Go does not know that it is an array string, and it is impossible to convert it directly. Instead, we need an intermediary conversion.</p>
<p>The Firebase Token struct is defined as:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#75715e">// Token represents a decoded Firebase ID token.
</span><span style="color:#75715e">//
</span><span style="color:#75715e">// Token provides typed accessors to the common JWT fields such as Audience (aud) and Expiry (exp).
</span><span style="color:#75715e">// Additionally it provides a UID field, which indicates the user ID of the account to which this token
</span><span style="color:#75715e">// belongs. Any additional JWT claims can be accessed via the Claims map of Token.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Token</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">AuthTime</span> <span style="color:#66d9ef">int64</span>				   <span style="color:#e6db74">`json:&#34;auth_time&#34;`</span>
	<span style="color:#a6e22e">Issuer</span>   <span style="color:#66d9ef">string</span>				   <span style="color:#e6db74">`json:&#34;iss&#34;`</span>
	<span style="color:#a6e22e">Audience</span> <span style="color:#66d9ef">string</span>				   <span style="color:#e6db74">`json:&#34;aud&#34;`</span>
	<span style="color:#a6e22e">Expires</span>  <span style="color:#66d9ef">int64</span>				   <span style="color:#e6db74">`json:&#34;exp&#34;`</span>
	<span style="color:#a6e22e">IssuedAt</span> <span style="color:#66d9ef">int64</span>				   <span style="color:#e6db74">`json:&#34;iat&#34;`</span>
	<span style="color:#a6e22e">Subject</span>  <span style="color:#66d9ef">string</span>				   <span style="color:#e6db74">`json:&#34;sub,omitempty&#34;`</span>
	<span style="color:#a6e22e">UID</span>	  <span style="color:#66d9ef">string</span>				   <span style="color:#e6db74">`json:&#34;uid,omitempty&#34;`</span>
	<span style="color:#a6e22e">Firebase</span> <span style="color:#a6e22e">FirebaseInfo</span>		    <span style="color:#e6db74">`json:&#34;firebase&#34;`</span>
	<span style="color:#a6e22e">Claims</span>   <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{} <span style="color:#e6db74">`json:&#34;-&#34;`</span>
}
</code></pre></div><p>The field we are concerned with is <code>Claims</code>. It is a map of interfaces. It will hold additional information that is added upstream when a user is created. We can assume that one of these pieces of data added is a <code>roles</code> field that consists of an array of strings. E.g.: <code>[&quot;role1&quot;, &quot;role2&quot;, &quot;role3&quot;]</code></p>
<p>After extracting the <code>claims</code>, and accessing the <code>roles</code> field, we need to convert the <code>interface</code> type to <code>[]interface{}</code>, because we can&rsquo;t convert directly from <code>interface</code> to <code>[]string</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#a6e22e">roles</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">claims</span>[<span style="color:#e6db74">&#34;roles&#34;</span>]
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">roles</span> []<span style="color:#66d9ef">string</span>
<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">claims</span>[<span style="color:#e6db74">&#34;roles&#34;</span>].([]<span style="color:#66d9ef">interface</span>{}) {
   <span style="color:#a6e22e">roles</span> = append(<span style="color:#a6e22e">roles</span>, <span style="color:#a6e22e">p</span>.(<span style="color:#66d9ef">string</span>))
}
</code></pre></div><p>The takeaway for me was that <code>interface{}</code> can&rsquo;t be converted to <code>[]someType{}</code>. We can only convert from interface to another type if the shapes are similar.</p>
<p>Reference:
<a href="https://golang.org/ref/spec#Type_assertions">https://golang.org/ref/spec#Type_assertions</a></p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
